<!-- blog/templates/blog/detalle.html -->
<!DOCTYPE html>
<html>
<head>
    <title>{{ post.titulo }}</title>
</head>
<body>
    <h1>{{ post.titulo }}</h1>
    <p><strong>Publicado:</strong> {{ post.fecha_creacion }}</p>

    <div>
        {{ post.contenido }}
    </div>

    <!-- üè∑Ô∏è Mostrar etiquetas asociadas al post -->
    <p><strong>Etiquetas:</strong>
        {% for tag in post.tags.all %}
            <a href="{% url 'posts_by_tag' tag.name %}">{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
        {% empty %}
            Sin etiquetas
        {% endfor %}
    </p>

    <hr>

    <!-- üí¨ Comentarios -->
    <h2>Comentarios</h2>

    {% if comentarios %}
        {% for comentario in comentarios %}
            <div style="margin-bottom: 15px;">
                <p><strong>{{ comentario.autor.username }}</strong> dijo:</p>
                <p>{{ comentario.contenido }}</p>
                <p><small>{{ comentario.fecha_creacion|date:"d M Y H:i" }}</small></p>
                {% if user == comentario.autor or user.is_staff %}
                    <p>
                        <a href="{% url 'editar_comentario' comentario.id %}">Editar</a> |
                        <a href="{% url 'eliminar_comentario' comentario.id %}">Eliminar</a>
                    </p>
                {% endif %}
                <hr>
            </div>
        {% endfor %}
    {% else %}
        <p>No hay comentarios todav√≠a.</p>
    {% endif %}

    <!-- üìù Formulario de nuevo comentario -->
    {% if user.is_authenticated %}
        <h3>Agregar un comentario</h3>
        <form method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit">Comentar</button>
        </form>
    {% else %}
        <p><a href="{% url 'login' %}">Inicia sesi√≥n</a> para comentar.</p>
    {% endif %}

    <br>
    <a href="{% url 'lista_posts' %}">‚Üê Volver a la lista</a>
    {% if comentario.id %}
    <a href="{% url 'editar_comentario' comentario.id %}">Editar</a>
    <a href="{% url 'eliminar_comentario' comentario.id %}">Eliminar</a>
    {% endif %}
    
</body>
</html>