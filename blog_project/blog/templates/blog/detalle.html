<!-- blog/templates/blog/detalle.html -->
<!DOCTYPE html>
<html>
<head>
    <title>{{ post.titulo }}</title>
</head>
<body>
    <h1>{{ post.titulo }}</h1>
    <p><strong>Publicado:</strong> {{ post.fecha_creacion }}</p>
    {% if post.imagenes.all %}
        <div style="margin-top: 20px;">
            <h3>Im√°genes</h3>
            {% for imagen in post.imagenes.all %}
                <div style="margin-bottom: 15px;">
                <img src="{{ imagen.imagen.url }}" alt="{{ imagen.descripcion }}" style="max-width: 100%; height: auto;">
                {% if imagen.descripcion %}
                    <p><em>{{ imagen.descripcion }}</em></p>
                {% endif %}
                </div>
            {% endfor %}
        </div>
    {% endif %}
    <div>
        {{ post.contenido }}
    </div>

    <!-- üè∑Ô∏è Mostrar etiquetas asociadas al post -->
    <p><strong>Etiquetas:</strong>
        {% for tag in post.tags.all %}
            <a href="{% url 'posts_by_tag' tag.name %}">{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
        {% empty %}
            Sin etiquetas
        {% endfor %}
    </p>

    <hr>

    <!-- üí¨ Comentarios -->
    <h2>Comentarios</h2>
    {% if messages %}
        <ul style="list-style: none; padding: 0;">
            {% for message in messages %}
                <li style="
                background-color: {% if message.tags == 'success' %}#d4edda{% elif message.tags == 'error' %}#f8d7da{% elif message.tags == 'warning' %}#fff3cd{% endif %};
                border: 1px solid {% if message.tags == 'success' %}#c3e6cb{% elif message.tags == 'error' %}#f5c6cb{% elif message.tags == 'warning' %}#ffeeba{% endif %};
                color: #000;
                padding: 10px;
                margin-bottom: 10px;
                border-radius: 5px;
            ">
                {{ message }}
                </li>
         {% endfor %}
    </ul>
{% endif %}
    {% if comentarios %}
        {% for comentario in comentarios %}
            {% include 'blog/comentario.html' with comentario=comentario nivel=0 %}
        {% endfor %}
    {% else %}
        <p>No hay comentarios todav√≠a.</p>
    {% endif %}

    <!-- üìù Formulario de nuevo comentario -->
    {% if user.is_authenticated %}
        <h3>Agregar un comentario</h3>
        <form method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit">Comentar</button>
        </form>
    {% else %}
        <p><strong>Etiquetas:</strong>
    {% for tag in post.tags.all %}
        <a href="{% url 'posts_by_tag' tag.slug %}">{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
    {% empty %}
        Sin etiquetas
    {% endfor %}
</p>
    {% endif %}

    <br>
    <a href="{% url 'lista_posts' %}">‚Üê Volver a la lista</a>
    {% if comentario.id %}
    <a href="{% url 'editar_comentario' comentario.id %}">Editar</a>
    <a href="{% url 'eliminar_comentario' comentario.id %}">Eliminar</a>
    {% endif %}
    
</body>
</html>